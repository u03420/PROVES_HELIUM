<?xml version="1.0" encoding="UTF-8"?>

<process-definition 
  xmlns="urn:jbpm.org:jpdl-3.2"
  name="AC_Proves">


	<start-state name="Inici">
		<transition to="Alta client"></transition>
	</start-state>
   <task-node name="Dades i generació document">
		<task name="N010_DADES_DOCUMENT">
			<description>
				Generació document i signatura applet
			</description>
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Signatura applet" name="Signatura applet"></transition>
		<transition to="Dades portasignatures" name="Enviar al portasignatures"></transition>
	</task-node>

	<state name="Enviar al Portasignatures">
		<event type="node-enter">
			<action class="net.conselldemallorca.helium.jbpm3.handlers.PortasignaturesHandler" name="signatura" config-type="bean">
				<document>
					NOTA_INFORMATIVA
				</document>
				<importancia>
					high
				</importancia>
				<transicioOK>
					Aceptar
				</transicioOK>
				<transicioKO>
					Rebutjar
				</transicioKO>
				<varResponsableCodi>
					exp_destinatari
				</varResponsableCodi>
			</action>
		</event>
		<transition to="Signatura rebutjada" name="Rebutjar"></transition>
		<transition to="Signatura rebuda" name="Aceptar"></transition>
	</state>

	<task-node name="Signatura rebutjada">
		<task name="N050_SIGNATURA_REBUTJADA">
			<description>
				Gestionar Signatura
			</description>
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Fi"></transition>
		<transition to="Enviar al Portasignatures" name="Tornar a enviar"></transition>
	</task-node>

	<task-node name="Dades portasignatures">
		<task name="N030_DADES_PORTASIGNATURES">
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Enviar al Portasignatures" name="Enviar"></transition>
	</task-node>

	<task-node name="Signatura applet">
		<task name="N020_SIGNATURA_APPLET">
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Fi"></transition>
	</task-node>

	<task-node name="Signatura rebuda">
		<task name="N040_SIGNATURA_REBUDA">
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Fi"></transition>
	</task-node>

	<task-node name="Alta client">
		<task name="N01_ALTA_CLIENT">
			<assignment expression="group(XSN_GN_HELIUM_ADMIN)"></assignment>
		</task>
		<transition to="Existeix client ?" name="Processar"></transition>
		<transition to="Fi" name="Finalitzar"></transition>
	</task-node>

	<decision name="Existeix client ?">
		<transition to="Dades i generació document" name="Si">
			<condition expression='#{exp_codcli != null &amp;&amp; exp_codcli !=""}'></condition>
		</transition>
		<transition to="Fi" name="No"></transition>
	</decision>

   <end-state name="Fi"></end-state>




</process-definition>